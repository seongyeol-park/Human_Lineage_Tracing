drawTree <- function(tree, xlim=NULL, mark=NULL) {
  
  g1 <- as(tree, 'phylo4')
  d  <- data.frame(color=rep("black", length(tree$tip.label)), row.names=tree$tip.label)
  d$color <- as.character(d$color)
  
  if(!is.null(mark)) d$color[grepl(mark, rownames(d))] <- "red" # annotate tip
  
  g2 <- phylo4d(g1, d)
  rNodeData <- data.frame(color=rep("black", nNodes(g1)), row.names=nodeId(g1, "internal"))
  rNodeData$color <- as.character(rNodeData$color)
  
  if(!is.null(mark)) rNodeData$color[which(rownames(rNodeData) %in% names(nodeLabels(g1))[grepl(mark, nodeLabels(g1))])] <- "red" # annotate node
  nodeData(g2) <- rNodeData
  
  p <- ggtree(g2, aes(color=I(color))) + geom_nodelab()
  
  if(!is.null(xlim)) p <- p + coord_cartesian(xlim=xlim)
  
  edge           <- data.frame(tree$edge, edge_length=tree$edge.length)
  colnames(edge) <- c("parent", "node", "edge_length")
  p              <- p %<+% edge + geom_label(aes(x=branch, label=edge_length), na.rm = TRUE)
  
  #print(p)
  
  return(p)
  
}



read.tree(textConnection("((((((((0222111122211:0,0222111122212:0)02221111222:2,0222111122112:0)0222111122:1,(0222111121112:0)0222111121:3)022211112:1,(0222111111112:0)02221111111:1,(0222111112221:0)0222111112:5)02221111:2,((0222111212121:0,0222111212122:0)022211121:4,((0222111221111:0)0222111221:3,(0222111222221:0)02221112222:3)022211122:2)02221112:2,((((0222112122212:0)022211212221:2,(0222112122221:0)022211212222:2)0222112122:4,(0222112121211:0)0222112121:2)022211212:1,(0222112112111:0)022211211:9)02221121:1,(((0222112221111:0)02221122211:2,(0222112221212:0)02221122212:2)0222112221:1,(0222112222112:0)022211222211:3,0222112222212:0)022211222:1,(0222112211222:0)022211221:5)022211:2,((((0222122211222:0)022212221122:3,(0222122212222:0)02221222122:3)022212221:2,((0222122221122:0)02221222211:1,(0222122221211:0)02221222212:1)0222122221:1,((0222122222122:0)022212222212:2,(0222122222212:0)02221222222:3)0222122222:1)02221222:1,((0222122121221:0)022212212122:2,0222122121122:0)0222122121:2,(0222122122111:0)0222122122:5)0222122:2,((((0222121111122:0)02221211111:2,(0222121111211:0)02221211112:2)022212111:3,((0222121121211:0)022212112121:1,(0222121121222:0)022212112122:1)0222121121:3)02221211:2,(0222121221112:0,0222121221211:0,0222121221212:0)02221212:7)0222121:1)02221:1,((((((0221112211121:0,0221112211122:0)0221112211:4,((0221112212221:0)02211122122:2,0221112212122:0)0221112212:2)022111221:2,(0221112222221:0)02211122222:3)02211122:1,((0221112111221:0)022111211122:1,(0221112112211:0)0221112112:5)022111211:1,((0221112121111:0)0221112121:6,(0221112122211:0)022111212221:2)022111212:1)0221112:1,(((0221111112212:0)022111111221:1,(0221111112222:0)022111111222:1)022111111:3,((0221111121112:0)022111112111:1,(0221111122212:0)02211111222:2)022111112:2)02211111:3,((0221111221122:0)0221111221:6,(0221111222121:0)02211112221:3)022111122:2,(0221111211221:0)022111121:2)022111:3,((((0221122211221:0,0221122211222:0)0221122211:1,(0221122212211:0)0221122212:4)022112221:3,((0221122221112:0)022112222111:4,(0221122221121:0)022112222112:1)0221122221:1)02211222:2,(((0221122111121:0)022112211112:2,0221122111112:0)0221122111:3,(0221122112211:0)0221122112:5)022112211:1,(0221122121111:0)022112212:6)0221122:1,(((0221121122112:0)02211211221:1,(0221121122212:0)022112112221:4)02211211:6,((0221121211212:0)022112121:6,(0221121221222:0)02211212212:4)02211212:2)0221121:2)02211:1,((((((0222211121121:0,0222211121122:0)02222111211:1,(0222211122111:0)0222211122:4)022221112:2,(0222211111111:0,0222211111122:0)02222111111:1,(0222211112122:0)02222111121:1)02222111:2,(((0222211211122:0)02222112111:2,(0222211211221:0)02222112112:3)022221121:4,((0222211221221:0)0222211221:2,(0222211222222:0)0222211222:3)022221122:1)02222112:1)0222211:2,(((((0222212112111:0)022221211211:2,(0222212112121:0)022221211212:1)02222121121:4,(0222212112222:0)02222121122:4)0222212112:1,((0222212121122:0)02222121211:2,(0222212122222:0)0222212122:3)022221212:1,(0222212111112:0)02222121111:5)02222121:2,(((0222212211121:0)02222122111:1,(0222212211221:0)022221221122:1)0222212211:2,(0222212212211:0,0222212212222:0)0222212212:3)022221221:2)0222212:1)022221:2,((0222222211111:0,0222222211122:0)02222222111:1,((0222222222112:0)022222222211:4,(0222222222221:0)02222222222:2)022222222:3,(0222222112221:0)02222221122:3,(0222222212211:0)0222222212:4)0222222:1,((0222221212211:0)022222121221:1,0222221212221:0)02222212:7,(0222221121111:0)02222211:8)02222:1,(((((0221212122121:0,0221212122122:0)0221212122:5,(0221212121222:0)022121212122:1)022121212:1,((0221212211112:0)022121221111:1,(0221212211211:0)02212122112:4,(0221212212211:0)0221212212:2)02212122:4,(0221212112112:0)022121211:8)0221212:1,((0221211211221:0)022121121:8,(0221211221121:0)022121122:6)02212112:1,(0221211111111:0)0221211111:3,(0221211112111:0)0221211112:6,(0221211122121:0)022121112:4)022121:1,(0221221121111:0,0221221121112:0)0221221121:2,((0221222111211:0)02212221112:2,(0221222112112:0)0221222112:4)022122211:1,((0221222121111:0)02212221211:2,(0221222122111:0)0221222122:1)022122212:1,(0221221211211:0)0221221211:1,(0221221221221:0)0221221221:5,(0221221222111:0)0221221222:4)02212:1)0:4)G0:0;"))

read.tree(textConnection(df_temp$tree[2])) %>% ggtree()


file_list <- list.files('/home/users/chrono0707/projects/02_DB/01_DB3/14_Simulations/01_initial_screening', pattern = '.tsv$', full.names = T)
dt <- read_tsv(file_list[1])
dt

subdt <- dt %>% filter(abs(initial_rate - 6) < 0.5 & (rate - 0.79) < 0.2 & at == 3) 
read.tree(textConnection(as.character(subdt$tree[4]))) %>% ggtree()+theme_tree2()

          